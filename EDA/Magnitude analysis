/*
=========================================================================
Magnitude analysis
========================================================================
Script Purpose:
    This script compares the measure values by categories, which helps us
	understand the importance of different categories
*/

--Find total customers by countries
IF OBJECT_ID('total_customers_by_countries','U') IS NOT NULL
	DROP TABLE total_customers_by_countries
GO

SELECT
	country,
	COUNT(customer_key) AS total_customers
INTO
	total_customers_by_countries
FROM
	gold.dim_customers
GROUP BY 
	country
ORDER BY
	total_customers DESC
--Find total customers by gender
SELECT
	gender,
	COUNT(customer_key) AS total_customers
FROM
	gold.dim_customers
GROUP BY 
	gender
ORDER BY
	total_customers DESC
--Find total products by category 
SELECT
	category,
	COUNT(product_key) AS total_products 
FROM
	gold.dim_products
GROUP BY 
	category
ORDER BY
	total_products DESC
--What is the average cost in each category 
SELECT
	category,
	AVG(cost) AS average_cost
FROM
	gold.dim_products
GROUP BY 
	category
ORDER BY
	average_cost DESC
--What is the total revenue generated by each category
SELECT
	category,
	SUM(sales_amount) AS total_revenue
FROM
	gold.fact_sales AS S
LEFT JOIN
	gold.dim_products AS P
ON 
	S.product_key = P.product_key
GROUP BY 
	category
ORDER BY
	total_revenue DESC
--What is the total revenue generated by each customer
SELECT
	C.customer_key,
	SUM(sales_amount) AS total_revenue
FROM
	gold.fact_sales AS S
LEFT JOIN
	gold.dim_customers AS C
ON 
	S.product_key = C.customer_key
GROUP BY 
	C.customer_key
ORDER BY
	total_revenue DESC

--What is the distribution of sold items across countries
SELECT
	C.country,
	SUM(quantity) AS sold_items
FROM
	gold.fact_sales AS S
LEFT JOIN
	gold.dim_customers AS C
ON
	S.customer_key = C.customer_key
GROUP BY 
	C.country
ORDER BY
	C.country
